<!DOCTYPE html>
<html>

<head>
  <title>d3-x3d : 3D Heat Map Component Example</title>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://x3dom.org/download/dev/x3dom-full.js"></script>
  <link rel="stylesheet" href="https://x3dom.org/download/dev/x3dom.css"/>
  <script src="../../../dist/d3-x3d.js"></script>
</head>

<body>
  <div id="chartholder"></div>

  <script>
    // https://codepen.io/pranavk26/pen/vYmxZWm

    var data = [
      { row: 1, column: 1, val: 2 },
      { row: 6, column: 14, val: 1 },
      { row: 1, column: 2, val: 4 },
      { row: 1, column: 3, val: 7 },
      { row: 2, column: 9, val: 8 },
      { row: 2, column: 10, val: 4 },
      { row: 2, column: 11, val: 2 },
      { row: 2, column: 12, val: 9 },
      { row: 3, column: 12, val: 5 },
      { row: 3, column: 13, val: 9 },
      { row: 3, column: 14, val: 1 },
      { row: 3, column: 15, val: 2 },
      { row: 4, column: 1, val: 2 },
      { row: 4, column: 2, val: 4 },
      { row: 4, column: 3, val: 7 },
      { row: 4, column: 4, val: 2 },
      { row: 2, column: 13, val: 3 },
      { row: 2, column: 14, val: 3 },
      { row: 2, column: 15, val: 2 },
      { row: 3, column: 1, val: 8 },
      { row: 3, column: 2, val: 3 },
      { row: 3, column: 3, val: 8 },
      { row: 3, column: 4, val: 1 },
      { row: 3, column: 5, val: 8 },
      { row: 2, column: 5, val: 5 },
      { row: 1, column: 4, val: 2 },
      { row: 1, column: 5, val: 4 },
      { row: 1, column: 6, val: 7 },
      { row: 1, column: 7, val: 2 },
      { row: 1, column: 8, val: 4 },
      { row: 1, column: 11, val: 4 },
      { row: 1, column: 12, val: 7 },
      { row: 1, column: 13, val: 2 },
      { row: 1, column: 14, val: 4 },
      { row: 1, column: 9, val: 7 },
      { row: 1, column: 10, val: 2 },
      { row: 1, column: 11, val: 4 },
      { row: 1, column: 12, val: 7 },
      { row: 1, column: 13, val: 2 },
      { row: 1, column: 14, val: 4 },
      { row: 1, column: 15, val: 7 },
      { row: 2, column: 1, val: 6 },
      { row: 2, column: 2, val: 5 },
      { row: 2, column: 3, val: 3 },
      { row: 2, column: 4, val: 2 },
      { row: 2, column: 6, val: 7 },
      { row: 2, column: 7, val: 1 },
      { row: 2, column: 8, val: 1 },
      { row: 3, column: 6, val: 7 },
      { row: 3, column: 7, val: 4 },
      { row: 3, column: 8, val: 3 },
      { row: 3, column: 9, val: 2 },
      { row: 3, column: 10, val: 7 },
      { row: 3, column: 11, val: 5 },
      { row: 4, column: 5, val: 4 },
      { row: 4, column: 6, val: 7 },
      { row: 4, column: 7, val: 2 },
      { row: 4, column: 8, val: 4 },
      { row: 4, column: 9, val: 7 },
      { row: 4, column: 10, val: 2 },
      { row: 4, column: 11, val: 4 },
      { row: 4, column: 12, val: 7 },
      { row: 4, column: 13, val: 2 },
      { row: 4, column: 14, val: 4 },
      { row: 4, column: 15, val: 7 },
      { row: 5, column: 1, val: 6 },
      { row: 5, column: 2, val: 5 },
      { row: 5, column: 3, val: 3 },
      { row: 5, column: 4, val: 2 },
      { row: 5, column: 5, val: 5 },
      { row: 5, column: 6, val: 7 },
      { row: 5, column: 7, val: 1 },
      { row: 5, column: 8, val: 1 },
      { row: 5, column: 9, val: 8 },
      { row: 5, column: 10, val: 4 },
      { row: 5, column: 11, val: 2 },
      { row: 5, column: 12, val: 9 },
      { row: 5, column: 13, val: 3 },
      { row: 5, column: 14, val: 3 },
      { row: 5, column: 15, val: 2 },
      { row: 6, column: 1, val: 8 },
      { row: 6, column: 2, val: 3 },
      { row: 6, column: 3, val: 8 },
      { row: 6, column: 4, val: 1 },
      { row: 6, column: 5, val: 8 },
      { row: 6, column: 6, val: 7 },
      { row: 6, column: 7, val: 4 },
      { row: 6, column: 8, val: 3 },
      { row: 6, column: 9, val: 2 },
      { row: 1, column: 14, val: 4 },
      { row: 6, column: 15, val: 2 },
      { row: 6, column: 10, val: 7 },
      { row: 6, column: 11, val: 5 },
      { row: 6, column: 12, val: 5 },
      { row: 6, column: 13, val: 9 },
      { row: 1, column: 11, val: 4 },
      { row: 1, column: 12, val: 7 },
      { row: 1, column: 13, val: 2 }
    ];
    console.log(data);

    let formatData = d3.nest()
      .key(function(d) { return d.row; })
      .entries(data.sort((a, b) => {
        return +a.row - +b.row;
      }))
      .map((d) => {
        return {
          key: d.key, values: d3.nest()
            .key((d) => {
              return d.column;
            })
            .entries(d.values.sort((a, b) => {
              return +a.column - +b.column;
            }))
            .map((d) => {
              return { key: d.key, value: d.values[0].val };
            })
        };
      });

    console.log(formatData);

    // Chart dimensions
    var width = 500;
    var height = 500;

    // Color scale
    let colors = ["blue", "red"];
    let valueExtent = [0, 10];
    colorScale = d3.scaleLinear()
      .domain(valueExtent)
      .range(colors);

    // Create components
    var viewpoint = d3.x3d.component.viewpoint();
    var heatMap = d3.x3d.component.heatMap()
      .colorScale(colorScale);

    // Create scene
    var scene = d3.select("#chartholder")
      .append("X3D")
      .attr("width", width + "px")
      .attr("height", height + "px")
      .append("Scene");

    scene
      .call(viewpoint);

    var chart = scene.append("Group")
      .attr("class", "chart");

    chart.datum(formatData)
      .call(heatMap);

  </script>

  <div style="clear: both">Created with <a href="https://github.com/jamesleesaunders/d3-x3d">d3-x3d</a> D3 X3D Data Visualization Library.</div>
</body>

</html>
