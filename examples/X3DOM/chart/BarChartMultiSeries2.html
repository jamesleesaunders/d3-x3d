<!DOCTYPE html>
<html>

<head>
  <title>d3-x3d : 3D Multi Series Bar Chart Example</title>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://x3dom.org/download/dev/x3dom-full.js"></script>
  <link rel="stylesheet" href="https://x3dom.org/download/dev/x3dom.css"/>
  <script src="../../../dist/d3-x3d.js"></script>
</head>

<body>
<div id="chartholder"></div>

<script>
  // https://codepen.io/pranavk26/pen/vYmxZWm

  function groupBy(array, f) {
    var groups = {};
    array.forEach(function(o) {
      var group = JSON.stringify(f(o));
      groups[group] = groups[group] || [];
      groups[group].push(o);
    });
    return Object.keys(groups).map(function(group) {
      return groups[group];
    })
  }

  function sortByRow(array) {
    return array.sort(function(a, b) {
      var x = a.row;
      var y = b.row;
      return ((x < y) ? -1 : ((x > y ? 1 : 0)));
    });
  }

  function sortByColumn(array) {
    return array.sort(function(a, b) {
      var x = a.column;
      var y = b.column;
      return ((x < y) ? -1 : ((x > y ? 1 : 0)));
    });
  }

  function arrToJSON(array) {
    var result = [];
    sortByRow(array);
    var columns = groupBy(array, function(item) {
      return [item.row];
    });
    for (var a = 0; a < columns.length; a++) {
      sortByColumn(columns[a]);
      result.push({ key: columns[a][0]['row'].toString(), values: [] });
      for (var b = 0; b < columns[a].length; b++) {
        result[a]['values'].push({ key: columns[a][b]['column'].toString(), value: columns[a][b]['val'] });
      }
    }
    return result;
  }

  var data = [
    { row: 1, column: 1, val: 2 },
    { row: 1, column: 2, val: 4 },
    { row: 1, column: 3, val: 7 },
    { row: 1, column: 4, val: 2 },
    { row: 1, column: 5, val: 4 },
    { row: 1, column: 6, val: 7 },
    { row: 1, column: 7, val: 2 },
    { row: 1, column: 8, val: 4 },
    { row: 1, column: 9, val: 7 },
    { row: 1, column: 10, val: 2 },
    { row: 1, column: 11, val: 4 },
    { row: 1, column: 12, val: 7 },
    { row: 1, column: 13, val: 2 },
    { row: 1, column: 14, val: 4 },
    { row: 1, column: 15, val: 7 },
    { row: 2, column: 1, val: 6 },
    { row: 2, column: 2, val: 5 },
    { row: 2, column: 3, val: 3 },
    { row: 2, column: 4, val: 2 },
    { row: 2, column: 5, val: 5 },
    { row: 2, column: 6, val: 7 },
    { row: 2, column: 7, val: 1 },
    { row: 2, column: 8, val: 1 },
    { row: 2, column: 9, val: 8 },
    { row: 2, column: 10, val: 4 },
    { row: 2, column: 11, val: 2 },
    { row: 2, column: 12, val: 9 },
    { row: 2, column: 13, val: 3 },
    { row: 2, column: 14, val: 3 },
    { row: 2, column: 15, val: 2 },
    { row: 3, column: 1, val: 8 },
    { row: 3, column: 2, val: 3 },
    { row: 3, column: 3, val: 8 },
    { row: 3, column: 4, val: 1 },
    { row: 3, column: 5, val: 8 },
    { row: 3, column: 6, val: 7 },
    { row: 3, column: 7, val: 4 },
    { row: 3, column: 8, val: 3 },
    { row: 3, column: 9, val: 2 },
    { row: 3, column: 10, val: 7 },
    { row: 3, column: 11, val: 5 },
    { row: 3, column: 12, val: 5 },
    { row: 3, column: 13, val: 9 },
    { row: 3, column: 14, val: 1 },
    { row: 3, column: 15, val: 2 }
  ];
  console.log(data);

  var formatData = arrToJSON(data);
  console.log(formatData);

  var chartholder = d3.select("#chartholder");

  // Declare the chart component
  var myChart = d3.x3d.chart.barChartMultiSeries();

  // Attach chart and data to the chartholder
  chartholder
    .datum(formatData)
    .call(myChart);

</script>

<div style="clear: both">Created with <a href="https://github.com/jamesleesaunders/d3-x3d">d3-x3d</a> D3 X3D Data
  Visualization Library.
</div>
</body>

</html>
