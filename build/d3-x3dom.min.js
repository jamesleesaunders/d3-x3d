(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory(require("d3")):typeof define==="function"&&define.amd?define(["d3"],factory):(global.d3=global.d3||{},global.d3.x3dom=factory(global.d3))})(this,function(d3){"use strict";var version="1.3.0";var license="GPL-2.0";var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();function dataTransform(data){var SINGLE_SERIES=1;var MULTI_SERIES=2;var coordinateKeys=["x","y","z"];var dataType=data.key!==undefined?SINGLE_SERIES:MULTI_SERIES;var rowKey=function(){if(dataType===SINGLE_SERIES){return d3.values(data)[0]}}();var rowTotal=function(){if(dataType===SINGLE_SERIES){return d3.sum(data.values,function(d){return d.value})}}();var rowKeys=function(){if(dataType===MULTI_SERIES){return data.map(function(d){return d.key})}}();var rowTotals=function(){if(dataType===MULTI_SERIES){var ret={};d3.map(data).values().forEach(function(d){var rowKey=d.key;d.values.forEach(function(d){ret[rowKey]=typeof ret[rowKey]==="undefined"?0:ret[rowKey];ret[rowKey]+=d.value})});return ret}}();var rowTotalsMax=function(){if(dataType===MULTI_SERIES){return d3.max(d3.values(rowTotals))}}();var rowValuesKeys=function(){if(dataType===SINGLE_SERIES){return Object.keys(data.values[0])}else{return Object.keys(data[0].values[0])}}();var union=function union(array1,array2){var ret=[];var arr=array1.concat(array2);var len=arr.length;var assoc={};while(len--){var item=arr[len];if(!assoc[item]){ret.unshift(item);assoc[item]=true}}return ret};var columnKeys=function(){if(dataType===SINGLE_SERIES){return d3.values(data.values).map(function(d){return d.key})}var ret=[];d3.map(data).values().forEach(function(d){var tmp=[];d.values.forEach(function(d,i){tmp[i]=d.key});ret=union(tmp,ret)});return ret}();var columnTotals=function(){if(dataType!==MULTI_SERIES){return}var ret={};d3.map(data).values().forEach(function(d){d.values.forEach(function(d){var columnName=d.key;ret[columnName]=typeof ret[columnName]==="undefined"?0:ret[columnName];ret[columnName]+=d.value})});return ret}();var columnTotalsMax=function(){if(dataType===MULTI_SERIES){return d3.max(d3.values(columnTotals))}}();var valueMin=function(){if(dataType===SINGLE_SERIES){return d3.min(data.values,function(d){return+d.value})}var ret=void 0;d3.map(data).values().forEach(function(d){d.values.forEach(function(d){ret=typeof ret==="undefined"?d.value:d3.min([ret,+d.value])})});return+ret}();var valueMax=function(){var ret=void 0;if(dataType===SINGLE_SERIES){ret=d3.max(data.values,function(d){return+d.value})}else{d3.map(data).values().forEach(function(d){d.values.forEach(function(d){ret=typeof ret!=="undefined"?d3.max([ret,+d.value]):+d.value})})}return ret}();var valueExtent=function(){return[valueMin,valueMax]}();var coordinatesMin=function(){var ret={};if(dataType===SINGLE_SERIES){coordinateKeys.forEach(function(key){ret[key]=d3.min(data.values,function(d){return+d[key]})});return ret}else{d3.map(data).values().forEach(function(d){d.values.forEach(function(d){coordinateKeys.forEach(function(key){ret[key]=key in ret?d3.min([ret[key],+d[key]]):d[key]})})})}return ret}();var coordinatesMax=function(){var ret={};if(dataType===SINGLE_SERIES){coordinateKeys.forEach(function(key){ret[key]=d3.max(data.values,function(d){return+d[key]})});return ret}else{d3.map(data).values().forEach(function(d){d.values.forEach(function(d){coordinateKeys.forEach(function(key){ret[key]=key in ret?d3.max([ret[key],+d[key]]):d[key]})})})}return ret}();var coordinatesExtent=function(){var ret={};coordinateKeys.forEach(function(key){ret[key]=[coordinatesMin[key],coordinatesMax[key]]});return ret}();var decimalPlaces=function decimalPlaces(num){var match=(""+num).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);if(!match){return 0}return Math.max(0,(match[1]?match[1].length:0)-(match[2]?+match[2]:0))};var maxDecimalPlace=function(){var ret=0;if(dataType===MULTI_SERIES){d3.map(data).values().forEach(function(d){d.values.forEach(function(d){ret=d3.max([ret,decimalPlaces(d.value)])})})}return ret>20?20:ret}();var thresholds=function(){var distance=valueMax-valueMin;var bands=[.15,.4,.55,.9];return bands.map(function(v){return Number((valueMin+v*distance).toFixed(maxDecimalPlace))})}();var summary=function summary(){return{dataType:dataType,rowKey:rowKey,rowTotal:rowTotal,rowKeys:rowKeys,rowTotals:rowTotals,rowTotalsMax:rowTotalsMax,rowValuesKeys:rowValuesKeys,columnKeys:columnKeys,columnTotals:columnTotals,columnTotalsMax:columnTotalsMax,valueMin:valueMin,valueMax:valueMax,valueExtent:valueExtent,coordinatesMin:coordinatesMin,coordinatesMax:coordinatesMax,coordinatesExtent:coordinatesExtent,maxDecimalPlace:maxDecimalPlace,thresholds:thresholds}};var rotate=function rotate(){var columnKeys=data.map(function(d){return d.key});var rowKeys=data[0].values.map(function(d){return d.key});var rotated=rowKeys.map(function(rowKey,rowIndex){var values=columnKeys.map(function(columnKey,columnIndex){var values=_extends({},data[columnIndex].values[rowIndex]);values.key=columnKey;return values});return{key:rowKey,values:values}});return rotated};return{summary:summary,rotate:rotate}}function componentArea(){var dimensions={x:40,y:40,z:5};var color="red";var transparency=0;var classed="d3X3domArea";var xScale=void 0;var yScale=void 0;var array2dToString=function array2dToString(arr){return arr.reduce(function(a,b){return a.concat(b)},[]).reduce(function(a,b){return a.concat(b)},[]).join(" ")};var arrayToCoordIndex=function arrayToCoordIndex(arr,offset){return arr.map(function(d,i){return i+offset}).join(" ").concat(" -1")};var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),columnKeys=_dataTransform$summar.columnKeys,valueMax=_dataTransform$summar.valueMax;var valueExtent=[0,valueMax];var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y;if(typeof xScale==="undefined"){xScale=d3.scalePoint().domain(columnKeys).range([0,dimensionX])}if(typeof yScale==="undefined"){yScale=d3.scaleLinear().domain(valueExtent).range([0,dimensionY])}};var my=function my(selection){selection.each(function(data){init(data);var element=d3.select(this).classed(classed,true).attr("id",function(d){return d.key});var areaData=function areaData(d){return d.map(function(pointThis,indexThis,array){var indexNext=indexThis+1;if(indexNext>=array.length){return null}var pointNext=array[indexNext];var x1=xScale(pointThis.key);var x2=xScale(pointNext.key);var y1=yScale(pointThis.value);var y2=yScale(pointNext.value);var points=[[x1,0,0],[x1,y1,0],[x2,y2,0],[x2,0,0]];return{key:pointThis.key,value:pointThis.value,points:points}}).filter(function(d){return d!==null})};var shape=function shape(el){var shape=el.append("shape");shape.html("\n\t\t\t\t<indexedfaceset coordIndex='' solid='false'>\n\t\t\t\t\t<coordinate point=''></coordinate>\n\t\t\t\t</indexedfaceset>\n\t\t\t\t<appearance>\n\t\t\t\t\t<material diffuseColor='"+color+"' transparency='"+transparency+"'></material>\n\t\t\t\t</appearance>\n\t\t\t");return shape};function addIndices(d){var shape=d3.select(this).select("shape");var ifs=shape.select("indexedfaceset");var coord=ifs.select("coordinate");var point=coord.attr("point");if(typeof point!=="string"){point=""}coord.attr("point",point+" "+array2dToString(d.points));var lastIndex=point.split(" ").length-1;var coordIndex=ifs.attr("coordindex")+" ";ifs.attr("coordindex",coordIndex+arrayToCoordIndex(d.points,lastIndex/3))}var group=element.selectAll("group").data(function(d){return[d]}).enter().append("group").classed("area",true).call(shape);var area=group.selectAll(".area").data(function(d){return areaData(d.values)},function(d){return d.key});area.enter().each(addIndices).merge(area);area.transition().select("shape").select("appearance").select("material").attr("diffusecolor",function(d){return d.color});area.exit().remove()})};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.color=function(_v){if(!arguments.length)return color;color=_v;return my};return my}function componentAreaMultiSeries(){var dimensions={x:40,y:40,z:40};var colors=["orange","red","yellow","steelblue","green"];var classed="d3X3domAreaMultiSeries";var xScale=void 0;var yScale=void 0;var zScale=void 0;var colorScale=void 0;var colorDomain=[];var area=componentArea();var arrayUnique=function arrayUnique(array1,array2){var array=array1.concat(array2);var a=array.concat();for(var i=0;i<a.length;++i){for(var j=i+1;j<a.length;++j){if(a[i]===a[j]){a.splice(j--,1)}}}return a};var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),rowKeys=_dataTransform$summar.rowKeys,columnKeys=_dataTransform$summar.columnKeys,valueMax=_dataTransform$summar.valueMax;var valueExtent=[0,valueMax];var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;xScale=d3.scalePoint().domain(columnKeys).range([0,dimensionX]);yScale=d3.scaleLinear().domain(valueExtent).range([0,dimensionY]);zScale=d3.scaleBand().domain(rowKeys).range([0,dimensionZ]).padding(.4);colorDomain=arrayUnique(colorDomain,rowKeys);colorScale=d3.scaleOrdinal().domain(colorDomain).range(colors)};var my=function my(selection){selection.each(function(data){init(data);var element=d3.select(this).classed(classed,true);area.xScale(xScale).yScale(yScale).dimensions({x:dimensions.x,y:dimensions.y,z:zScale.bandwidth()});var addArea=function addArea(d){var color=colorScale(d.key);area.color(color);d3.select(this).call(area)};var areaGroup=element.selectAll(".areaGroup").data(function(d){return d},function(d){return d.key});areaGroup.enter().append("transform").classed("areaGroup",true).merge(areaGroup).transition().attr("translation",function(d){var x=0;var y=0;var z=zScale(d.key);return x+" "+y+" "+z}).each(addArea);areaGroup.exit().remove()})};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};return my}function componentAxis(){var dimensions={x:40,y:40,z:40};var color="black";var classed="d3X3domAxis";var labelPosition="proximal";var labelInset=labelPosition==="distal"?1:-1;var scale=void 0;var direction=void 0;var tickDirection=void 0;var tickArguments=[];var tickValues=null;var tickFormat=null;var tickSize=1;var tickPadding=1.5;var axisDirectionVectors={x:[1,0,0],y:[0,1,0],z:[0,0,1]};var axisRotationVectors={x:[1,1,0,Math.PI],y:[0,0,0,0],z:[0,1,1,Math.PI]};var getAxisDirectionVector=function getAxisDirectionVector(axisDir){return axisDirectionVectors[axisDir]};var getAxisRotationVector=function getAxisRotationVector(axisDir){return axisRotationVectors[axisDir]};var my=function my(selection){selection.each(function(){var element=d3.select(this).classed(classed,true);var makeSolid=function makeSolid(shape,color){shape.append("appearance").append("material").attr("diffuseColor",color||"black");return shape};var range=scale.range();var range0=range[0];var range1=range[range.length-1];var axisDirectionVector=getAxisDirectionVector(direction);var tickDirectionVector=getAxisDirectionVector(tickDirection);var axisRotationVector=getAxisRotationVector(direction);var tickRotationVector=getAxisRotationVector(tickDirection);tickValues=scale.ticks?scale.ticks.apply(scale,tickArguments):scale.domain();var tickFormatDefault=scale.tickFormat?scale.tickFormat.apply(scale,tickArguments):function(d){return d};tickFormat=tickFormat===null?tickFormatDefault:tickFormat;var domain=element.selectAll(".domain").data([null]);var domainEnter=domain.enter().append("transform").attr("class","domain").attr("rotation",axisRotationVector.join(" ")).attr("translation",axisDirectionVector.map(function(d){return d*(range0+range1)/2}).join(" ")).append("shape").call(makeSolid,color).append("cylinder").attr("radius",.1).attr("height",range1-range0);domainEnter.merge(domain);domain.exit().remove();var ticks=element.selectAll(".tick").data(tickValues);var ticksEnter=ticks.enter().append("transform").attr("class","tick").attr("translation",function(t){return axisDirectionVector.map(function(a){return scale(t)*a}).join(" ")}).append("transform").attr("translation",tickDirectionVector.map(function(d){return d*tickSize/2}).join(" ")).attr("rotation",tickRotationVector.join(" ")).append("shape").call(makeSolid,"#d3d3d3").append("cylinder").attr("radius",.05).attr("height",tickSize);ticksEnter.merge(ticks);ticks.transition().attr("translation",function(t){return axisDirectionVector.map(function(a){return scale(t)*a}).join(" ")});ticks.exit().remove();if(tickFormat!==""){var labels=element.selectAll(".label").data(tickValues);var labelsEnter=ticks.enter().append("transform").attr("class","label").attr("translation",function(t){return axisDirectionVector.map(function(a){return scale(t)*a}).join(" ")}).append("transform").attr("translation",tickDirectionVector.map(function(d,i){return labelInset*d*tickPadding+(labelInset+1)/2*(range1-range0)*tickDirectionVector[i]})).append("billboard").attr("axisofrotation","0 0 0").append("shape").call(makeSolid,"black").append("text").attr("string",tickFormat).append("fontstyle").attr("size",1.3).attr("family","SANS").attr("style","BOLD").attr("justify","MIDDLE");labelsEnter.merge(labels);labels.transition().attr("translation",function(t){return axisDirectionVector.map(function(a){return scale(t)*a}).join(" ")}).select("transform").attr("translation",tickDirectionVector.map(function(d,i){return labelInset*d*tickPadding+(labelInset+1)/2*(range1-range0)*tickDirectionVector[i]})).on("start",function(){d3.select(this).select("billboard").select("shape").select("text").attr("string",tickFormat)});labels.exit().remove()}})};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return my};my.scale=function(_v){if(!arguments.length)return scale;scale=_v;return my};my.direction=function(_v){if(!arguments.length)return direction;direction=_v;return my};my.tickDirection=function(_v){if(!arguments.length)return tickDirection;tickDirection=_v;return my};my.tickArguments=function(_v){if(!arguments.length)return tickArguments;tickArguments=_v;return my};my.tickValues=function(_v){if(!arguments.length)return tickValues;tickValues=_v;return my};my.tickFormat=function(_v){if(!arguments.length)return tickFormat;tickFormat=_v;return my};my.tickSize=function(_v){if(!arguments.length)return tickSize;tickSize=_v;return my};my.tickPadding=function(_v){if(!arguments.length)return tickPadding;tickPadding=_v;return my};my.color=function(_v){if(!arguments.length)return color;color=_v;return my};my.labelPosition=function(_v){if(!arguments.length)return labelPosition;labelPosition=_v;labelInset=labelPosition==="distal"?1:-1;return my};return my}function componentAxisThreePlane(){var dimensions={x:40,y:40,z:40};var colors=["blue","red","green"];var classed="d3X3domAxisThreePlane";var labelPosition="proximal";var xScale=void 0;var yScale=void 0;var zScale=void 0;var xzAxis=componentAxis();var yzAxis=componentAxis();var yxAxis=componentAxis();var zxAxis=componentAxis();var my=function my(selection){selection.each(function(){var element=d3.select(this).classed(classed,true);var layers=["xzAxis","yzAxis","yxAxis","zxAxis"];element.selectAll("group").data(layers).enter().append("group").attr("class",function(d){return d});xzAxis.scale(xScale).direction("x").tickDirection("z").tickSize(zScale.range()[1]-zScale.range()[0]).color("blue").labelPosition(labelPosition);yzAxis.scale(yScale).direction("y").tickDirection("z").tickSize(zScale.range()[1]-zScale.range()[0]).color("red").labelPosition(labelPosition);yxAxis.scale(yScale).direction("y").tickDirection("x").tickSize(xScale.range()[1]-xScale.range()[0]).tickFormat("").color("red").labelPosition(labelPosition);zxAxis.scale(zScale).direction("z").tickDirection("x").tickSize(xScale.range()[1]-xScale.range()[0]).color("black").labelPosition(labelPosition);element.select(".xzAxis").call(xzAxis);element.select(".yzAxis").call(yzAxis);element.select(".yxAxis").call(yxAxis);element.select(".zxAxis").call(zxAxis)})};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};my.labelPosition=function(_v){if(!arguments.length)return labelPosition;labelPosition=_v;return my};return my}var dispatch=d3.dispatch("d3X3domClick","d3X3domMouseOver","d3X3domMouseOut");function forwardEvent(event){var type=event.type;var target=d3.select(event.target);target.on(type)(event)}function getEventCoordinates(event){var pagePoint=getEventPagePoint(event);return{world:{x:event.hitPnt[0],y:event.hitPnt[1],z:event.hitPnt[2]},canvas:{x:event.layerX,y:event.layerY},page:{x:pagePoint.x,y:pagePoint.y}}}function getEventPagePoint(event){var pageX=-1;var pageY=-1;var convertPoint=window.webkitConvertPointFromPageToNode;if("getBoundingClientRect"in document.documentElement){var holder=getX3domHolder(event);var computedStyle=document.defaultView.getComputedStyle(holder,null);var paddingLeft=parseFloat(computedStyle.getPropertyValue("padding-left"));var borderLeftWidth=parseFloat(computedStyle.getPropertyValue("border-left-width"));var paddingTop=parseFloat(computedStyle.getPropertyValue("padding-top"));var borderTopWidth=parseFloat(computedStyle.getPropertyValue("border-top-width"));var box=holder.getBoundingClientRect();var scrolLeft=window.pageXOffset||document.body.scrollLeft;var scrollTop=window.pageYOffset||document.body.scrollTop;pageX=Math.round(event.layerX+(box.left+paddingLeft+borderLeftWidth+scrolLeft));pageY=Math.round(event.layerY+(box.top+paddingTop+borderTopWidth+scrollTop))}else if(convertPoint){var pagePoint=convertPoint(event.target,new WebKitPoint(0,0));pageX=Math.round(pagePoint.x);pageY=Math.round(pagePoint.y)}else{x3dom.debug.logError("Unable to find getBoundingClientRect or webkitConvertPointFromPageToNode")}return{x:pageX,y:pageY}}function getX3domHolder(event){var target=d3.select(event.target);var x3d=target.select(function(){var el=this;while(el.nodeName.toLowerCase()!=="x3d"){el=el.parentElement}return el});return x3d.select(function(){return this.parentNode}).node()}var events=Object.freeze({dispatch:dispatch,forwardEvent:forwardEvent,getEventCoordinates:getEventCoordinates,getEventPagePoint:getEventPagePoint,getX3domHolder:getX3domHolder});function componentBars(){var dimensions={x:40,y:40,z:2};var colors=["orange","red","yellow","steelblue","green"];var classed="d3X3domBars";var xScale=void 0;var yScale=void 0;var colorScale=void 0;var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),columnKeys=_dataTransform$summar.columnKeys,valueMax=_dataTransform$summar.valueMax;var valueExtent=[0,valueMax];var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y;if(typeof xScale==="undefined"){xScale=d3.scaleBand().domain(columnKeys).rangeRound([0,dimensionX]).padding(.3)}if(typeof yScale==="undefined"){yScale=d3.scaleLinear().domain(valueExtent).range([0,dimensionY])}if(typeof colorScale==="undefined"){colorScale=d3.scaleOrdinal().domain(columnKeys).range(colors)}};var my=function my(selection){selection.each(function(data){init(data);var element=d3.select(this).classed(classed,true).attr("id",function(d){return d.key});var shape=function shape(el){var shape=el.append("shape").attr("onclick","d3.x3dom.events.forwardEvent(event);").on("click",function(e){dispatch.call("d3X3domClick",this,e)}).attr("onmouseover","d3.x3dom.events.forwardEvent(event);").on("mouseover",function(e){dispatch.call("d3X3domMouseOver",this,e)}).attr("onmouseout","d3.x3dom.events.forwardEvent(event);").on("mouseout",function(e){dispatch.call("d3X3domMouseOut",this,e)});shape.append("box").attr("size","1.0 1.0 1.0");shape.append("appearance").append("material").attr("diffusecolor",function(d){return colorScale(d.key)}).attr("ambientintensity",.1);return shape};var bars=element.selectAll(".bar").data(function(d){return d.values},function(d){return d.key});bars.enter().append("transform").classed("bar",true).call(shape).merge(bars).transition().attr("scale",function(d){var x=xScale.bandwidth();var y=yScale(d.value);var z=dimensions.z;return x+" "+y+" "+z}).attr("translation",function(d){var x=xScale(d.key);var y=yScale(d.value)/2;var z=0;return x+" "+y+" "+z});bars.exit().remove()})};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};my.on=function(){var value=dispatch.on.apply(dispatch,arguments);return value===dispatch?my:value};return my}function componentBarsMultiSeries(){var dimensions={x:40,y:40,z:40};var colors=["orange","red","yellow","steelblue","green"];var classed="d3X3domBarsMultiSeries";var xScale=void 0;var yScale=void 0;var zScale=void 0;var colorScale=void 0;var bars=componentBars();var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),rowKeys=_dataTransform$summar.rowKeys,columnKeys=_dataTransform$summar.columnKeys,valueMax=_dataTransform$summar.valueMax;var valueExtent=[0,valueMax];var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;xScale=d3.scaleBand().domain(columnKeys).rangeRound([0,dimensionX]).padding(.5);yScale=d3.scaleLinear().domain(valueExtent).range([0,dimensionY]).nice();zScale=d3.scaleBand().domain(rowKeys).range([0,dimensionZ]).padding(.7);colorScale=d3.scaleOrdinal().domain(columnKeys).range(colors)};var my=function my(selection){selection.each(function(data){init(data);var element=d3.select(this).classed(classed,true);bars.xScale(xScale).yScale(yScale).dimensions({x:dimensions.x,y:dimensions.y,z:zScale.bandwidth()}).colors(colors);var addBars=function addBars(){d3.select(this).call(bars)};var barGroup=element.selectAll(".barGroup").data(function(d){return d},function(d){return d.key});barGroup.enter().append("transform").classed("barGroup",true).merge(barGroup).transition().attr("translation",function(d){var x=0;var y=0;var z=zScale(d.key);return x+" "+y+" "+z}).each(addBars);barGroup.exit().remove()})};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};return my}function componentBubbles(){var dimensions={x:40,y:40,z:40};var color="orange";var classed="d3X3domBubbles";var xScale=void 0;var yScale=void 0;var zScale=void 0;var sizeScale=void 0;var sizeDomain=[.5,4];var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),valueExtent=_dataTransform$summar.valueExtent,coordinatesMax=_dataTransform$summar.coordinatesMax;var maxX=coordinatesMax.x,maxY=coordinatesMax.y,maxZ=coordinatesMax.z;var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;if(typeof xScale==="undefined"){xScale=d3.scaleLinear().domain([0,maxX]).range([0,dimensionX])}if(typeof yScale==="undefined"){yScale=d3.scaleLinear().domain([0,maxY]).range([0,dimensionY])}if(typeof zScale==="undefined"){zScale=d3.scaleLinear().domain([0,maxZ]).range([0,dimensionZ])}if(typeof sizeScale==="undefined"){sizeScale=d3.scaleLinear().domain(valueExtent).range(sizeDomain)}};var my=function my(selection){selection.each(function(data){init(data);var element=d3.select(this).classed(classed,true).attr("id",function(d){return d.key});var shape=function shape(el){var shape=el.append("shape").attr("onclick","d3.x3dom.events.forwardEvent(event);").on("click",function(e){dispatch.call("d3X3domClick",this,e)}).attr("onmouseover","d3.x3dom.events.forwardEvent(event);").on("mouseover",function(e){dispatch.call("d3X3domMouseOver",this,e)}).attr("onmouseout","d3.x3dom.events.forwardEvent(event);").on("mouseout",function(e){dispatch.call("d3X3domMouseOut",this,e)});shape.html(function(d){return"<sphere radius='"+sizeScale(d.value)+"'></sphere>"});shape.append("appearance").append("material").attr("diffusecolor",color).attr("ambientintensity",.1);return shape};var bubbles=element.selectAll(".bubble").data(function(d){return d.values},function(d){return d.key});bubbles.enter().append("transform").attr("class","bubble").call(shape).merge(bubbles).transition().attr("translation",function(d){return xScale(d.x)+" "+yScale(d.y)+" "+zScale(d.z)}).select("shape").select("appearance").select("material").attr("diffusecolor",color);bubbles.exit().remove()})};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.sizeScale=function(_v){if(!arguments.length)return sizeScale;sizeScale=_v;return my};my.sizeDomain=function(_v){if(!arguments.length)return sizeDomain;sizeDomain=_v;return my};my.color=function(_v){if(!arguments.length)return color;color=_v;return my};my.on=function(){var value=dispatch.on.apply(dispatch,arguments);return value===dispatch?my:value};return my}function componentBubblesMultiSeries(){var dimensions={x:40,y:40,z:40};var colors=["green","red","yellow","steelblue","orange"];var classed="d3X3domBubblesMultiSeries";var xScale=void 0;var yScale=void 0;var zScale=void 0;var colorScale=void 0;var sizeScale=void 0;var sizeDomain=[.5,3];var colorDomain=[];var bubbles=componentBubbles();var arrayUnique=function arrayUnique(array1,array2){var array=array1.concat(array2);var a=array.concat();for(var i=0;i<a.length;++i){for(var j=i+1;j<a.length;++j){if(a[i]===a[j]){a.splice(j--,1)}}}return a};var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),rowKeys=_dataTransform$summar.rowKeys,valueExtent=_dataTransform$summar.valueExtent,coordinatesMax=_dataTransform$summar.coordinatesMax;var maxX=coordinatesMax.x,maxY=coordinatesMax.y,maxZ=coordinatesMax.z;var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;xScale=d3.scaleLinear().domain([0,maxX]).range([0,dimensionX]);yScale=d3.scaleLinear().domain([0,maxY]).range([0,dimensionY]);zScale=d3.scaleLinear().domain([0,maxZ]).range([0,dimensionZ]);colorDomain=arrayUnique(colorDomain,rowKeys);colorScale=d3.scaleOrdinal().domain(colorDomain).range(colors);sizeScale=d3.scaleLinear().domain(valueExtent).range(sizeDomain)};var my=function my(selection){selection.each(function(data){init(data);var element=d3.select(this).classed(classed,true);bubbles.xScale(xScale).yScale(yScale).zScale(zScale).sizeScale(sizeScale);var addBubbles=function addBubbles(d){var color=colorScale(d.key);bubbles.color(color);d3.select(this).datum(d).call(bubbles)};var bubbleGroup=element.selectAll(".bubbleGroup").data(function(d){return d},function(d){return d.key});bubbleGroup.enter().append("group").classed("bubbleGroup",true).merge(bubbleGroup).transition().each(addBubbles);bubbleGroup.exit().remove()})};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.sizeScale=function(_v){if(!arguments.length)return sizeScale;sizeScale=_v;return my};my.sizeDomain=function(_v){if(!arguments.length)return sizeDomain;sizeDomain=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};my.on=function(){var value=dispatch.on.apply(dispatch,arguments);return value===dispatch?my:value};return my}function componentCrosshair(){var dimensions={x:40,y:40,z:40};var colors=["blue","red","green"];var classed="d3X3domCrosshair";var radius=.1;var xScale=void 0;var yScale=void 0;var zScale=void 0;var my=function my(selection){selection.each(function(data){var element=d3.select(this).classed(classed,true).attr("id",function(d){return d.key});var xOff=dimensions["x"]/2;var yOff=dimensions["y"]/2;var zOff=dimensions["z"]/2;var xVal=xScale(data.x);var yVal=yScale(data.y);var zVal=zScale(data.z);var positionVectors={x:[xOff,yVal,zVal],y:[xVal,yOff,zVal],z:[xVal,yVal,zOff]};function getPositionVector(axisDir){return positionVectors[axisDir].join(" ")}var rotationVectors={x:[1,1,0,Math.PI],y:[0,0,0,0],z:[0,1,1,Math.PI]};function getRotationVector(axisDir){return rotationVectors[axisDir].join(" ")}var colorScale=d3.scaleOrdinal().domain(Object.keys(dimensions)).range(colors);var ballSelect=element.selectAll(".ball").data([data]);var ball=ballSelect.enter().append("transform").attr("translation",function(d){return xScale(d.x)+" "+yScale(d.y)+" "+zScale(d.z)}).classed("ball",true).append("shape");ball.append("appearance").append("material").attr("diffusecolor","blue");ball.append("sphere").attr("radius",.3);ball.merge(ballSelect);ballSelect.transition().ease(d3.easeQuadOut).attr("translation",function(d){return xScale(d.x)+" "+yScale(d.y)+" "+zScale(d.z)});var lineSelect=element.selectAll(".line").data(Object.keys(dimensions));var line=lineSelect.enter().append("transform").classed("line",true).attr("translation",function(d){return getPositionVector(d)}).attr("rotation",function(d){return getRotationVector(d)}).append("shape");line.append("cylinder").attr("radius",radius).attr("height",function(d){return dimensions[d]});line.append("appearance").append("material").attr("diffusecolor",function(d){return colorScale(d)});line.merge(lineSelect);lineSelect.transition().ease(d3.easeQuadOut).attr("translation",function(d){return getPositionVector(d)})})};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};return my}function componentLabel(){var dimensions={x:40,y:40,z:40};var color="black";var classed="d3X3domLabel";var offset=0;var xScale=void 0;var yScale=void 0;var zScale=void 0;var my=function my(selection){selection.each(function(data){var element=d3.select(this).classed(classed,true).attr("id",function(d){return d.key});var makeSolid=function makeSolid(selection,color){selection.append("appearance").append("material").attr("diffusecolor",color||"black");return selection};var labelSelect=element.selectAll(".label").data([data]);var label=labelSelect.enter().append("transform").attr("translation",function(d){return xScale(d.x)+" "+yScale(d.y)+" "+zScale(d.z)}).classed("label",true).append("billboard").attr("axisofrotation","0 0 0").append("transform").attr("translation",function(d){return offset+" "+offset+" "+offset}).append("shape").call(makeSolid,color).append("text").attr("string",function(d){return d.key}).append("fontstyle").attr("size",1).attr("family","SANS").attr("style","BOLD").attr("justify","START");label.merge(labelSelect);labelSelect.transition().ease(d3.easeQuadOut).attr("translation",function(d){return xScale(d.x)+" "+yScale(d.y)+" "+zScale(d.z)})})};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.color=function(_v){if(!arguments.length)return color;color=_v;return my};my.offset=function(_v){if(!arguments.length)return offset;offset=_v;return my};return my}function componentLight(){var classed="d3X3domLight";var direction="1 0 -1";var intensity=.5;var shadowIntensity=0;var my=function my(selection){selection.each(function(){var element=d3.select(this).classed(classed,true);var light=element.selectAll("directionallight").data([null]);light.enter().append("directionallight").attr("on",true).attr("direction",direction).attr("intensity",intensity).attr("shadowintensity",shadowIntensity).merge(light)})};my.direction=function(_v){if(!arguments.length)return direction;direction=_v;return my};my.intensity=function(_v){if(!arguments.length)return intensity;intensity=_v;return my};my.shadowIntensity=function(_v){if(!arguments.length)return shadowIntensity;shadowIntensity=_v;return my};return my}function componentRibbon(){var dimensions={x:40,y:40,z:5};var color="red";var classed="d3X3domRibbon";var xScale=void 0;var yScale=void 0;var array2dToString=function array2dToString(arr){return arr.reduce(function(a,b){return a.concat(b)},[]).reduce(function(a,b){return a.concat(b)},[]).join(" ")};var arrayToCoordIndex=function arrayToCoordIndex(arr){return arr.map(function(d,i){return i}).join(" ").concat(" -1")};var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),columnKeys=_dataTransform$summar.columnKeys,valueMax=_dataTransform$summar.valueMax;var valueExtent=[0,valueMax];var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y;if(typeof xScale==="undefined"){xScale=d3.scalePoint().domain(columnKeys).range([0,dimensionX])}if(typeof yScale==="undefined"){yScale=d3.scaleLinear().domain(valueExtent).range([0,dimensionY])}};var my=function my(selection){selection.each(function(data){init(data);var element=d3.select(this).classed(classed,true).attr("id",function(d){return d.key});var ribbonData=function ribbonData(d){return d.map(function(pointThis,indexThis,array){var indexNext=indexThis+1;if(indexNext>=array.length){return null}var pointNext=array[indexNext];var x1=xScale(pointThis.key);var x2=xScale(pointNext.key);var y1=yScale(pointThis.value);var y2=yScale(pointNext.value);var z1=1-dimensions.z/2;var z2=dimensions.z/2;var points=[[x1,y1,z1],[x1,y1,z2],[x2,y2,z2],[x2,y2,z1],[x1,y1,z1]];return{key:pointThis.key,value:pointThis.value,coordindex:arrayToCoordIndex(points),point:array2dToString(points),color:color,transparency:.2}}).filter(function(d){return d!==null})};var shape=function shape(el){var shape=el.append("shape").attr("onclick","d3.x3dom.events.forwardEvent(event);").on("click",function(e){dispatch.call("d3X3domClick",this,e)}).attr("onmouseover","d3.x3dom.events.forwardEvent(event);").on("mouseover",function(e){dispatch.call("d3X3domMouseOver",this,e)}).attr("onmouseout","d3.x3dom.events.forwardEvent(event);").on("mouseout",function(e){dispatch.call("d3X3domMouseOut",this,e)});shape.html(function(d){var indexedfaceset='<indexedfaceset coordindex="'+d.coordindex+'"><coordinate point="'+d.point+'"></coordinate></indexedfaceset>';var appearance='<appearance><twosidedmaterial diffusecolor="'+d.color+'" transparency="'+d.transparency+'"></twosidedmaterial></appearance>';return indexedfaceset+appearance});return shape};var ribbon=element.selectAll(".ribbon").data(function(d){return ribbonData(d.values)},function(d){return d.key});ribbon.enter().append("group").classed("ribbon",true).call(shape).merge(ribbon);var ribbonTransition=ribbon.transition().select("shape");ribbonTransition.select("indexedfaceset").attr("coordindex",function(d){return d.coordindex}).select("coordinate").attr("point",function(d){return d.point});ribbonTransition.select("appearance").select("twosidedmaterial").attr("diffusecolor",function(d){return d.color});ribbon.exit().remove()})};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.color=function(_v){if(!arguments.length)return color;color=_v;return my};my.on=function(){var value=dispatch.on.apply(dispatch,arguments);return value===dispatch?my:value};return my}function componentRibbonMultiSeries(){var dimensions={x:40,y:40,z:40};var colors=["orange","red","yellow","steelblue","green"];var classed="d3X3domRibbonMultiSeries";var xScale=void 0;var yScale=void 0;var zScale=void 0;var colorScale=void 0;var colorDomain=[];var ribbon=componentRibbon();var arrayUnique=function arrayUnique(array1,array2){var array=array1.concat(array2);var a=array.concat();for(var i=0;i<a.length;++i){for(var j=i+1;j<a.length;++j){if(a[i]===a[j]){a.splice(j--,1)}}}return a};var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),rowKeys=_dataTransform$summar.rowKeys,columnKeys=_dataTransform$summar.columnKeys,valueMax=_dataTransform$summar.valueMax;var valueExtent=[0,valueMax];var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;xScale=d3.scalePoint().domain(columnKeys).range([0,dimensionX]);yScale=d3.scaleLinear().domain(valueExtent).range([0,dimensionY]);zScale=d3.scaleBand().domain(rowKeys).range([0,dimensionZ]).padding(.4);colorDomain=arrayUnique(colorDomain,rowKeys);colorScale=d3.scaleOrdinal().domain(colorDomain).range(colors)};var my=function my(selection){selection.each(function(data){init(data);var element=d3.select(this).classed(classed,true);ribbon.xScale(xScale).yScale(yScale).dimensions({x:dimensions.x,y:dimensions.y,z:zScale.bandwidth()});var addRibbon=function addRibbon(d){var color=colorScale(d.key);ribbon.color(color);d3.select(this).call(ribbon)};var ribbonGroup=element.selectAll(".ribbonGroup").data(function(d){return d},function(d){return d.key});ribbonGroup.enter().append("transform").classed("ribbonGroup",true).merge(ribbonGroup).transition().attr("translation",function(d){var x=0;var y=0;var z=zScale(d.key);return x+" "+y+" "+z}).each(addRibbon);ribbonGroup.exit().remove()})};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};my.on=function(){var value=dispatch.on.apply(dispatch,arguments);return value===dispatch?my:value};return my}function componentSurface(){var dimensions={x:40,y:40,z:40};var colors=["orange","maroon"];var classed="d3X3domSurface";var xScale=void 0;var yScale=void 0;var zScale=void 0;var colorScale=void 0;var array2dToString=function array2dToString(arr){return arr.reduce(function(a,b){return a.concat(b)},[]).reduce(function(a,b){return a.concat(b)},[]).join(" ")};var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),rowKeys=_dataTransform$summar.rowKeys,columnKeys=_dataTransform$summar.columnKeys,valueMax=_dataTransform$summar.valueMax;var valueExtent=[0,valueMax];var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;if(typeof xScale==="undefined"){xScale=d3.scalePoint().domain(rowKeys).range([0,dimensionX])}if(typeof yScale==="undefined"){yScale=d3.scaleLinear().domain(valueExtent).range([0,dimensionY])}if(typeof zScale==="undefined"){zScale=d3.scalePoint().domain(columnKeys).range([0,dimensionZ])}if(typeof colorScale==="undefined"){colorScale=d3.scaleLinear().domain(valueExtent).range(colors).interpolate(d3.interpolateLab)}};var my=function my(selection){selection.each(function(data){init(data);var element=d3.select(this).classed(classed,true);var surfaceData=function surfaceData(d){var coordPoints=function coordPoints(data){return data.map(function(X){return X.values.map(function(d){return[xScale(X.key),yScale(d.value),zScale(d.key)]})})};var coordIndex=function coordIndex(data){var ny=data.length;var nx=data[0].values.length;var coordIndexFront=Array.apply(0,Array(ny-1)).map(function(_,j){return Array.apply(0,Array(nx-1)).map(function(_,i){var start=i+j*nx;return[start,start+nx,start+nx+1,start+1,start,-1]})});var coordIndexBack=Array.apply(0,Array(ny-1)).map(function(_,j){return Array.apply(0,Array(nx-1)).map(function(_,i){var start=i+j*nx;return[start,start+1,start+nx+1,start+nx,start,-1]})});return coordIndexFront.concat(coordIndexBack)};var colorFaceSet=function colorFaceSet(data){return data.map(function(X){return X.values.map(function(d){var col=d3.color(colorScale(d.value));return""+Math.round(col.r/2.55)/100+" "+Math.round(col.g/2.55)/100+" "+Math.round(col.b/2.55)/100})})};return[{coordindex:array2dToString(coordIndex(d)),point:array2dToString(coordPoints(d)),color:array2dToString(colorFaceSet(d))}]};var surface=element.selectAll(".surface").data(surfaceData);var surfaceSelect=surface.enter().append("shape").classed("surface",true).append("indexedfaceset").attr("coordindex",function(d){return d.coordindex});surfaceSelect.append("coordinate").attr("point",function(d){return d.point});surfaceSelect.append("color").attr("color",function(d){return d.color});surfaceSelect.merge(surface);var surfaceTransition=surface.transition().select("indexedfaceset").attr("coordindex",function(d){return d.coordindex});surfaceTransition.select("coordinate").attr("point",function(d){return d.point});surfaceTransition.select("color").attr("color",function(d){return d.color});surface.exit().remove()})};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};my.on=function(){var value=dispatch.on.apply(dispatch,arguments);return value===dispatch?my:value};return my}function componentVectorFields(){var dimensions={x:40,y:40,z:40};var colors=d3.interpolateRdYlGn;var classed="d3X3domVectorFields";var xScale=void 0;var yScale=void 0;var zScale=void 0;var colorScale=void 0;var sizeScale=void 0;var sizeDomain=[2,5];var vectorFunction=function vectorFunction(x,y,z){return{vx:x,vy:y,vz:z}};var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),coordinatesMax=_dataTransform$summar.coordinatesMax,coordinatesMin=_dataTransform$summar.coordinatesMin;var minX=coordinatesMin.x,minY=coordinatesMin.y,minZ=coordinatesMin.z;var maxX=coordinatesMax.x,maxY=coordinatesMax.y,maxZ=coordinatesMax.z;var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;var extent=d3.extent(data.values.map(function(f){var vx=void 0,vy=void 0,vz=void 0;if("vx"in f){vx=f.vx;vy=f.vy;vz=f.vz}else{var _vectorFunction=vectorFunction(f.x,f.y,f.z,f.value);vx=_vectorFunction.vx;vy=_vectorFunction.vy;vz=_vectorFunction.vz}return new x3dom.fields.SFVec3f(vx,vy,vz).length()}));if(typeof xScale==="undefined"){xScale=d3.scaleLinear().domain([minX,maxX]).range([0,dimensionX])}if(typeof yScale==="undefined"){yScale=d3.scaleLinear().domain([minY,maxY]).range([0,dimensionY])}if(typeof zScale==="undefined"){zScale=d3.scaleLinear().domain([minZ,maxZ]).range([0,dimensionZ])}if(typeof colorScale==="undefined"){colorScale=d3.scaleSequential().domain(extent.slice().reverse()).interpolator(colors)}if(typeof sizeScale==="undefined"){sizeScale=d3.scaleLinear().domain(extent).range(sizeDomain)}};var my=function my(selection){selection.each(function(data){init(data);var element=d3.select(this).classed(classed,true).attr("id",function(d){return d.key});var vectorData=function vectorData(d){return d.values.map(function(f){var vx=void 0,vy=void 0,vz=void 0;if("vx"in f){vx=f.vx;vy=f.vy;vz=f.vz}else{var _vectorFunction2=vectorFunction(f.x,f.y,f.z,f.value);vx=_vectorFunction2.vx;vy=_vectorFunction2.vy;vz=_vectorFunction2.vz}var fromVector=new x3dom.fields.SFVec3f(0,1,0);var toVector=new x3dom.fields.SFVec3f(vx,vy,vz);var qDir=x3dom.fields.Quaternion.rotateFromTo(fromVector,toVector);var rot=qDir.toAxisAngle();if(!toVector.length()){return null}f.translation=xScale(f.x)+" "+yScale(f.y)+" "+zScale(f.z);f.value=toVector.length();f.rotation=rot[0].x+" "+rot[0].y+" "+rot[0].z+" "+rot[1];return f}).filter(function(f){return f!==null})};var arrows=element.selectAll(".arrow").data(vectorData);var arrowsEnter=arrows.enter().append("transform").attr("translation",function(d){return d.translation}).attr("rotation",function(d){return d.rotation}).attr("class","arrow").append("transform").attr("translation",function(d){var offset=sizeScale(d.value)/2;return"0 "+offset+" 0"}).append("group").attr("onclick","d3.x3dom.events.forwardEvent(event);").attr("onmouseover","d3.x3dom.events.forwardEvent(event);").attr("onmouseout","d3.x3dom.events.forwardEvent(event);");var arrowHead=arrowsEnter.append("shape").on("click",function(e){dispatch.call("d3X3domClick",this,e)}).on("mouseover",function(e){dispatch.call("d3X3domMouseOver",this,e)}).on("mouseout",function(e){dispatch.call("d3X3domMouseOut",this,e)});arrowHead.append("appearance").append("material").attr("diffusecolor",function(d){return rgb2Hex(colorScale(d.value))});arrowHead.append("cylinder").attr("height",function(d){return sizeScale(d.value)}).attr("radius",.1);var arrowShaft=arrowsEnter.append("transform").attr("translation",function(d){var offset=sizeScale(d.value)/2;return"0 "+offset+" 0"}).append("shape").on("click",function(e){dispatch.call("d3X3domClick",this,e)}).on("mouseover",function(e){dispatch.call("d3X3domMouseOver",this,e)}).on("mouseout",function(e){dispatch.call("d3X3domMouseOut",this,e)});arrowShaft.append("appearance").append("material").attr("diffusecolor",function(d){return rgb2Hex(colorScale(d.value))});arrowShaft.append("cone").attr("height",1).attr("bottomradius",.4);arrowsEnter.merge(arrows);arrows.transition().attr("translation",function(d){return d.translation});arrows.exit().remove()})};function rgb2Hex(rgbStr){var _rgbStr$substring$rep=rgbStr.substring(4,rgbStr.length-1).replace(/ /g,"").split(","),_rgbStr$substring$rep2=slicedToArray(_rgbStr$substring$rep,3),red=_rgbStr$substring$rep2[0],green=_rgbStr$substring$rep2[1],blue=_rgbStr$substring$rep2[2];var rgb=blue|green<<8|red<<16;return"#"+(16777216+rgb).toString(16).slice(1)}my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.sizeScale=function(_v){if(!arguments.length)return sizeScale;sizeScale=_v;return my};my.sizeDomain=function(_v){if(!arguments.length)return sizeDomain;sizeDomain=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};my.vectorFunction=function(_f){if(!arguments.length)return vectorFunction;vectorFunction=_f;return my};my.on=function(){var value=dispatch.on.apply(dispatch,arguments);return value===dispatch?my:value};return my}function componentViewpoint(){var centerOfRotation=[0,0,0];var viewPosition=[80,15,80];var viewOrientation=[0,1,0,.8];var fieldOfView=.8;var classed="d3X3domViewpoint";var my=function my(selection){selection.each(function(){var element=d3.select(this).classed(classed,true);var viewpoint=element.selectAll("viewpoint").data([null]);viewpoint.enter().append("viewpoint").attr("centerofrotation",centerOfRotation.join(" ")).attr("position",viewPosition.join(" ")).attr("orientation",viewOrientation.join(" ")).attr("fieldofview",fieldOfView).attr("set_bind","true").merge(viewpoint)})};my.quickView=function(view){switch(view){case"left":centerOfRotation=[0,0,0];viewPosition=[37.10119,18.70484,51.01594];viewOrientation=[.06724,.99767,-.01148,.33908];fieldOfView=1;break;case"side":centerOfRotation=[20,0,0];viewPosition=[20,20,50];viewOrientation=[0,0,0,0];fieldOfView=1;break;case"top":centerOfRotation=[0,0,0];viewPosition=[27.12955,106.67181,31.65828];viewOrientation=[-.86241,.3749,.34013,1.60141];fieldOfView=1;break;case"dimetric":default:centerOfRotation=[0,0,0];viewPosition=[80,15,80];viewOrientation=[0,1,0,.8];fieldOfView=.8}return my};my.centerOfRotation=function(_v){if(!arguments.length)return centerOfRotation;centerOfRotation=_v;return my};my.viewPosition=function(_v){if(!arguments.length)return viewPosition;viewPosition=_v;return my};my.viewOrientation=function(_v){if(!arguments.length)return viewOrientation;viewOrientation=_v;return my};my.fieldOfView=function(_v){if(!arguments.length)return fieldOfView;fieldOfView=_v;return my};return my}function componentVolumeSlice(){var dimensions={x:40,y:40,z:40};var classed="d3X3domVolumeSlice";var imageUrl=void 0;var numberOfSlices=void 0;var slicesOverX=void 0;var slicesOverY=void 0;var volumeStyle="opacitymap";var my=function my(selection){selection.each(function(data){var element=d3.select(this).classed(classed,true).attr("id",function(d){return d.key});var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;var volumedata=element.append("transform").append("volumedata").attr("dimensions",dimensionX+" "+dimensionY+" "+dimensionZ);volumedata.append("imagetextureatlas").attr("crossorigin","anonymous").attr("containerfield","voxels").attr("url",imageUrl).attr("numberofslices",numberOfSlices).attr("slicesoverx",slicesOverX).attr("slicesovery",slicesOverY);var plane=volumedata.selectAll(".plane").data(function(d){return d.values});switch(volumeStyle){case"mprvolume":plane.enter().append("mprvolumestyle").classed("plane",true).attr("finalline",function(d){return d.x+" "+d.y+" "+d.z}).attr("positionline",function(d){return d.value});break;case"opacitymap":default:volumedata.append("opacitymapvolumestyle").attr("lightfactor",1.2).attr("opacityfactor",6);break}})};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.imageUrl=function(_v){if(!arguments.length)return imageUrl;imageUrl=_v;return this};my.numberOfSlices=function(_v){if(!arguments.length)return numberOfSlices;numberOfSlices=_v;return this};my.slicesOverX=function(_v){if(!arguments.length)return slicesOverX;slicesOverX=_v;return this};my.slicesOverY=function(_v){if(!arguments.length)return slicesOverY;slicesOverY=_v;return this};my.volumeStyle=function(_v){if(!arguments.length)return volumeStyle;volumeStyle=_v;return this};return my}var component={area:componentArea,areaMultiSeries:componentAreaMultiSeries,axis:componentAxis,axisThreePlane:componentAxisThreePlane,bars:componentBars,barsMultiSeries:componentBarsMultiSeries,bubbles:componentBubbles,bubblesMultiSeries:componentBubblesMultiSeries,crosshair:componentCrosshair,label:componentLabel,light:componentLight,ribbon:componentRibbon,ribbonMultiSeries:componentRibbonMultiSeries,surface:componentSurface,vectorFields:componentVectorFields,viewpoint:componentViewpoint,volumeSlice:componentVolumeSlice};function chartAreaChartMultiSeries(){var x3d=void 0;var scene=void 0;var width=500;var height=500;var dimensions={x:60,y:40,z:40};var colors=["green","red","yellow","steelblue","orange"];var classed="d3X3domAreaChartMultiSeries";var debug=false;var xScale=void 0;var yScale=void 0;var zScale=void 0;var colorScale=void 0;var viewpoint=component.viewpoint();var axis=component.axisThreePlane();var areas=component.areaMultiSeries();var light=component.light();var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),rowKeys=_dataTransform$summar.rowKeys,columnKeys=_dataTransform$summar.columnKeys,valueMax=_dataTransform$summar.valueMax;var valueExtent=[0,valueMax];var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;xScale=d3.scalePoint().domain(columnKeys).range([0,dimensionX]);yScale=d3.scaleLinear().domain(valueExtent).range([0,dimensionY]).nice();zScale=d3.scaleBand().domain(rowKeys).range([0,dimensionZ]).padding(.4);colorScale=d3.scaleOrdinal().domain(columnKeys).range(colors)};var my=function my(selection){if(!x3d){x3d=selection.append("x3d");scene=x3d.append("scene")}x3d.attr("width",width+"px").attr("height",height+"px").attr("showLog",debug?"true":"false").attr("showStat",debug?"true":"false");var layers=["axis","areas"];scene.classed(classed,true).selectAll("group").data(layers).enter().append("group").attr("class",function(d){return d});selection.each(function(data){init(data);viewpoint.centerOfRotation([dimensions.x/2,dimensions.y/2,dimensions.z/2]).viewOrientation([-.61021,.77568,.16115,.65629]).viewPosition([77.63865,54.6947,104.38314]);scene.call(viewpoint);axis.xScale(xScale).yScale(yScale).zScale(zScale);scene.select(".axis").call(axis);areas.xScale(xScale).yScale(yScale).zScale(zScale).colors(colors).dimensions(dimensions);scene.select(".areas").datum(data).call(areas);scene.call(light)})};my.width=function(_v){if(!arguments.length)return width;width=_v;return this};my.height=function(_v){if(!arguments.length)return height;height=_v;return this};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};my.debug=function(_v){if(!arguments.length)return debug;debug=_v;return my};return my}function chartBarChartMultiSeries(){var x3d=void 0;var scene=void 0;var width=500;var height=500;var dimensions={x:40,y:40,z:40};var colors=["green","red","yellow","steelblue","orange"];var classed="d3X3domBarChartMultiSeries";var labelPosition="distal";var debug=false;var xScale=void 0;var yScale=void 0;var zScale=void 0;var colorScale=void 0;var viewpoint=component.viewpoint();var axis=component.axisThreePlane();var bars=component.barsMultiSeries();var light=component.light();var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),rowKeys=_dataTransform$summar.rowKeys,columnKeys=_dataTransform$summar.columnKeys,valueMax=_dataTransform$summar.valueMax;var valueExtent=[0,valueMax];var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;xScale=d3.scaleBand().domain(columnKeys).rangeRound([0,dimensionX]).padding(.5);yScale=d3.scaleLinear().domain(valueExtent).range([0,dimensionY]).nice();zScale=d3.scaleBand().domain(rowKeys).range([0,dimensionZ]).padding(.7);colorScale=d3.scaleOrdinal().domain(columnKeys).range(colors)};var my=function my(selection){if(!x3d){x3d=selection.append("x3d");scene=x3d.append("scene")}x3d.attr("width",width+"px").attr("height",height+"px").attr("showLog",debug?"true":"false").attr("showStat",debug?"true":"false");var layers=["axis","bars"];scene.classed(classed,true).selectAll("group").data(layers).enter().append("group").attr("class",function(d){return d});selection.each(function(data){init(data);viewpoint.centerOfRotation([dimensions.x/2,dimensions.y/2,dimensions.z/2]);scene.call(viewpoint);axis.xScale(xScale).yScale(yScale).zScale(zScale).labelPosition(labelPosition);scene.select(".axis").call(axis);bars.xScale(xScale).yScale(yScale).zScale(zScale).colors(colors);scene.select(".bars").datum(data).call(bars);scene.call(light)})};my.width=function(_v){if(!arguments.length)return width;width=_v;return this};my.height=function(_v){if(!arguments.length)return height;height=_v;return this};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};my.debug=function(_v){if(!arguments.length)return debug;debug=_v;return my};my.labelPosition=function(_v){if(!arguments.length)return labelPosition;labelPosition=_v;return my};return my}function chartBarChartVertical(){var x3d=void 0;var scene=void 0;var width=500;var height=500;var dimensions={x:40,y:40,z:40};var colors=["green","red","yellow","steelblue","orange"];var classed="d3X3domBarChartVertical";var debug=false;var xScale=void 0;var yScale=void 0;var colorScale=void 0;var viewpoint=component.viewpoint();var xAxis=component.axis();var yAxis=component.axis();var bars=component.bars();var light=component.light();var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),columnKeys=_dataTransform$summar.columnKeys,valueMax=_dataTransform$summar.valueMax;var valueExtent=[0,valueMax];var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y;xScale=d3.scaleBand().domain(columnKeys).rangeRound([0,dimensionX]).padding(.5);yScale=d3.scaleLinear().domain(valueExtent).range([0,dimensionY]).nice();colorScale=d3.scaleOrdinal().domain(columnKeys).range(colors)};var my=function my(selection){if(!x3d){x3d=selection.append("x3d");scene=x3d.append("scene")}x3d.attr("width",width+"px").attr("height",height+"px").attr("showLog",debug?"true":"false").attr("showStat",debug?"true":"false");var layers=["xAxis","yAxis","bars"];scene.classed(classed,true).selectAll("group").data(layers).enter().append("group").attr("class",function(d){return d});selection.each(function(data){init(data);viewpoint.quickView("left");scene.call(viewpoint);xAxis.scale(xScale).direction("x").tickDirection("y").tickSize(0);yAxis.scale(yScale).direction("y").tickDirection("x").tickSize(yScale.range()[1]-yScale.range()[0]);scene.select(".xAxis").call(xAxis);scene.select(".yAxis").call(yAxis);bars.xScale(xScale).yScale(yScale).colors(colors);scene.select(".bars").datum(data).call(bars);scene.call(light)})};my.width=function(_v){if(!arguments.length)return width;width=_v;return this};my.height=function(_v){if(!arguments.length)return height;height=_v;return this};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};my.debug=function(_v){if(!arguments.length)return debug;debug=_v;return my};return my}function chartBubbleChart(){var x3d=void 0;var scene=void 0;var width=500;var height=500;var dimensions={x:40,y:40,z:40};var colors=["green","red","yellow","steelblue","orange"];var classed="d3X3domBubbleChart";var debug=false;var xScale=void 0;var yScale=void 0;var zScale=void 0;var colorScale=void 0;var sizeScale=void 0;var sizeDomain=[.5,3.5];var viewpoint=component.viewpoint();var axis=component.axisThreePlane();var bubbles=component.bubblesMultiSeries();var light=component.light();var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),valueExtent=_dataTransform$summar.valueExtent,coordinatesMax=_dataTransform$summar.coordinatesMax,rowKeys=_dataTransform$summar.rowKeys;var maxX=coordinatesMax.x,maxY=coordinatesMax.y,maxZ=coordinatesMax.z;var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;xScale=d3.scaleLinear().domain([0,maxX]).range([0,dimensionX]);yScale=d3.scaleLinear().domain([0,maxY]).range([0,dimensionY]);zScale=d3.scaleLinear().domain([0,maxZ]).range([0,dimensionZ]);colorScale=d3.scaleOrdinal().domain(rowKeys).range(colors);sizeScale=d3.scaleLinear().domain(valueExtent).range(sizeDomain)};var my=function my(selection){if(!x3d){x3d=selection.append("x3d");scene=x3d.append("scene")}x3d.attr("width",width+"px").attr("height",height+"px").attr("showLog",debug?"true":"false").attr("showStat",debug?"true":"false");var layers=["axis","bubbles"];scene.classed(classed,true).selectAll("group").data(layers).enter().append("group").attr("class",function(d){return d});selection.each(function(data){init(data);viewpoint.centerOfRotation([dimensions.x/2,dimensions.y/2,dimensions.z/2]);scene.call(viewpoint);axis.xScale(xScale).yScale(yScale).zScale(zScale);scene.select(".axis").call(axis);bubbles.xScale(xScale).yScale(yScale).zScale(zScale).sizeScale(sizeScale).colorScale(colorScale);scene.select(".bubbles").datum(data).call(bubbles);scene.call(light)})};my.width=function(_v){if(!arguments.length)return width;width=_v;return this};my.height=function(_v){if(!arguments.length)return height;height=_v;return this};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};my.sizeScale=function(_v){if(!arguments.length)return sizeScale;sizeScale=_v;return my};my.sizeDomain=function(_v){if(!arguments.length)return sizeDomain;sizeDomain=_v;return my};my.debug=function(_v){if(!arguments.length)return debug;debug=_v;return my};return my}function chartCrosshairPlot(){var x3d=void 0;var scene=void 0;var width=500;var height=500;var dimensions={x:40,y:40,z:40};var classed="d3X3domCrosshairPlot";var debug=false;var xScale=void 0;var yScale=void 0;var zScale=void 0;var viewpoint=component.viewpoint();var axis=component.axisThreePlane();var crosshair=component.crosshair();var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),coordinatesMax=_dataTransform$summar.coordinatesMax;var maxX=coordinatesMax.x,maxY=coordinatesMax.y,maxZ=coordinatesMax.z;var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;xScale=d3.scaleLinear().domain([0,maxX]).range([0,dimensionX]);yScale=d3.scaleLinear().domain([0,maxY]).range([0,dimensionY]);zScale=d3.scaleLinear().domain([0,maxZ]).range([0,dimensionZ])};var my=function my(selection){if(!x3d){x3d=selection.append("x3d");scene=x3d.append("scene")}x3d.attr("width",width+"px").attr("height",height+"px").attr("showLog",debug?"true":"false").attr("showStat",debug?"true":"false");var layers=["axis","crosshairs"];scene.classed(classed,true).selectAll("group").data(layers).enter().append("group").attr("class",function(d){return d});selection.each(function(data){init(data);viewpoint.centerOfRotation([dimensions.x/2,dimensions.y/2,dimensions.z/2]);scene.call(viewpoint);axis.xScale(xScale).yScale(yScale).zScale(zScale).dimensions(dimensions);scene.select(".axis").call(axis);crosshair.xScale(xScale).yScale(yScale).zScale(zScale);var crosshairs=scene.select(".crosshairs").datum(data).selectAll(".crosshair").data(function(d){return d.values});crosshairs.enter().append("group").classed("crosshair",true).merge(crosshairs).transition().each(function(){d3.select(this).call(crosshair)})})};my.width=function(_v){if(!arguments.length)return width;width=_v;return this};my.height=function(_v){if(!arguments.length)return height;height=_v;return this};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.debug=function(_v){if(!arguments.length)return debug;debug=_v;return my};return my}function chartRibbonChartMultiSeries(){var x3d=void 0;var scene=void 0;var width=500;var height=500;var dimensions={x:60,y:40,z:40};var colors=["green","red","yellow","steelblue","orange"];var classed="d3X3domRibbonChartMultiSeries";var debug=false;var xScale=void 0;var yScale=void 0;var zScale=void 0;var colorScale=void 0;var viewpoint=component.viewpoint();var axis=component.axisThreePlane();var ribbons=component.ribbonMultiSeries();var light=component.light();var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),rowKeys=_dataTransform$summar.rowKeys,columnKeys=_dataTransform$summar.columnKeys,valueMax=_dataTransform$summar.valueMax;var valueExtent=[0,valueMax];var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;xScale=d3.scalePoint().domain(columnKeys).range([0,dimensionX]);yScale=d3.scaleLinear().domain(valueExtent).range([0,dimensionY]).nice();zScale=d3.scaleBand().domain(rowKeys).range([0,dimensionZ]).padding(.4);colorScale=d3.scaleOrdinal().domain(columnKeys).range(colors)};var my=function my(selection){if(!x3d){x3d=selection.append("x3d");scene=x3d.append("scene")}x3d.attr("width",width+"px").attr("height",height+"px").attr("showLog",debug?"true":"false").attr("showStat",debug?"true":"false");var layers=["axis","ribbons"];scene.classed(classed,true).selectAll("group").data(layers).enter().append("group").attr("class",function(d){return d});selection.each(function(data){init(data);viewpoint.centerOfRotation([dimensions.x/2,dimensions.y/2,dimensions.z/2]).viewOrientation([-.61021,.77568,.16115,.65629]).viewPosition([77.63865,54.6947,104.38314]);scene.call(viewpoint);axis.xScale(xScale).yScale(yScale).zScale(zScale);scene.select(".axis").call(axis);ribbons.xScale(xScale).yScale(yScale).zScale(zScale).colors(colors).dimensions(dimensions);scene.select(".ribbons").datum(data).call(ribbons);scene.call(light)})};my.width=function(_v){if(!arguments.length)return width;width=_v;return this};my.height=function(_v){if(!arguments.length)return height;height=_v;return this};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};my.debug=function(_v){if(!arguments.length)return debug;debug=_v;return my};return my}function chartScatterPlot(){var x3d=void 0;var scene=void 0;var width=500;var height=500;var dimensions={x:40,y:40,z:40};var color="orange";var classed="d3X3domScatterPlot";var debug=false;var xScale=void 0;var yScale=void 0;var zScale=void 0;var viewpoint=component.viewpoint();var axis=component.axisThreePlane();var crosshair=component.crosshair();var label=component.label();var bubbles=component.bubbles();var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),coordinatesMax=_dataTransform$summar.coordinatesMax;var maxX=coordinatesMax.x,maxY=coordinatesMax.y,maxZ=coordinatesMax.z;var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;xScale=d3.scaleLinear().domain([0,maxX]).range([0,dimensionX]);yScale=d3.scaleLinear().domain([0,maxY]).range([0,dimensionY]);zScale=d3.scaleLinear().domain([0,maxZ]).range([0,dimensionZ])};var my=function my(selection){if(!x3d){x3d=selection.append("x3d");scene=x3d.append("scene")}x3d.attr("width",width+"px").attr("height",height+"px").attr("showLog",debug?"true":"false").attr("showStat",debug?"true":"false");var layers=["axis","bubbles","crosshair","label"];scene.classed(classed,true).selectAll("group").data(layers).enter().append("group").attr("class",function(d){return d});selection.each(function(data){init(data);viewpoint.centerOfRotation([dimensions.x/2,dimensions.y/2,dimensions.z/2]);scene.call(viewpoint);axis.xScale(xScale).yScale(yScale).zScale(zScale);scene.select(".axis").call(axis);crosshair.xScale(xScale).yScale(yScale).zScale(zScale);label.xScale(xScale).yScale(yScale).zScale(zScale).offset(.5);bubbles.xScale(xScale).yScale(yScale).zScale(zScale).color(color).sizeDomain([.5,.5]).on("d3X3domClick",function(e){var d=d3.select(e.target).datum();scene.select(".crosshair").datum(d).classed("crosshair",true).each(function(){d3.select(this).call(crosshair)})}).on("d3X3domMouseOver",function(e){var d=d3.select(e.target).datum();scene.select(".label").datum(d).each(function(){d3.select(this).call(label)})}).on("d3X3domMouseOut",function(e){scene.select(".label").selectAll("*").remove()});scene.select(".bubbles").datum(data).call(bubbles)})};my.width=function(_v){if(!arguments.length)return width;width=_v;return this};my.height=function(_v){if(!arguments.length)return height;height=_v;return this};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.color=function(_v){if(!arguments.length)return color;color=_v;return my};my.debug=function(_v){if(!arguments.length)return debug;debug=_v;return my};my.on=function(){var value=dispatch.on.apply(dispatch,arguments);return value===dispatch?my:value};return my}function chartSurfacePlot(){var x3d=void 0;var scene=void 0;var width=500;var height=500;var dimensions={x:40,y:40,z:40};var colors=["blue","red"];var classed="d3X3domSurfacePlot";var debug=false;var xScale=void 0;var yScale=void 0;var zScale=void 0;var colorScale=void 0;var viewpoint=component.viewpoint();var axis=component.axisThreePlane();var surface=component.surface();var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),rowKeys=_dataTransform$summar.rowKeys,columnKeys=_dataTransform$summar.columnKeys,valueMax=_dataTransform$summar.valueMax;var valueExtent=[0,valueMax];var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;xScale=d3.scalePoint().domain(rowKeys).range([0,dimensionX]);yScale=d3.scaleLinear().domain(valueExtent).range([0,dimensionY]).nice();zScale=d3.scalePoint().domain(columnKeys).range([0,dimensionZ]);colorScale=d3.scaleLinear().domain(valueExtent).range(colors).interpolate(d3.interpolateLab)};var my=function my(selection){if(!x3d){x3d=selection.append("x3d");scene=x3d.append("scene")}x3d.attr("width",width+"px").attr("height",height+"px").attr("showLog",debug?"true":"false").attr("showStat",debug?"true":"false");var layers=["axis","surface"];scene.classed(classed,true).selectAll("group").data(layers).enter().append("group").attr("class",function(d){return d});selection.each(function(data){init(data);viewpoint.centerOfRotation([dimensions.x/2,dimensions.y/2,dimensions.z/2]);scene.call(viewpoint);axis.xScale(xScale).yScale(yScale).zScale(zScale).labelPosition("distal");scene.select(".axis").call(axis);surface.xScale(xScale).yScale(yScale).zScale(zScale).colors(colors);scene.select(".surface").datum(data).call(surface)})};my.width=function(_v){if(!arguments.length)return width;width=_v;return this};my.height=function(_v){if(!arguments.length)return height;height=_v;return this};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};my.debug=function(_v){if(!arguments.length)return debug;debug=_v;return my};return my}function chartVectorField(){var x3d=void 0;var scene=void 0;var width=500;var height=500;var dimensions={x:40,y:40,z:40};var colors=d3.interpolateRdYlGn;var classed="d3X3domVectorFieldChart";var debug=false;var xScale=void 0;var yScale=void 0;var zScale=void 0;var colorScale=void 0;var sizeScale=void 0;var sizeDomain=[2,5];var origin={x:0,y:0,z:0};var viewpoint=component.viewpoint();var axis=component.crosshair();var vectorFields=component.vectorFields();var vectorFunction=function vectorFunction(x,y,z){return{vx:x,vy:y,vz:z}};var init=function init(data){var _dataTransform$summar=dataTransform(data).summary(),coordinatesMax=_dataTransform$summar.coordinatesMax,coordinatesMin=_dataTransform$summar.coordinatesMin;var minX=coordinatesMin.x,minY=coordinatesMin.y,minZ=coordinatesMin.z;var maxX=coordinatesMax.x,maxY=coordinatesMax.y,maxZ=coordinatesMax.z;var _dimensions=dimensions,dimensionX=_dimensions.x,dimensionY=_dimensions.y,dimensionZ=_dimensions.z;var extent=d3.extent(data.values.map(function(f){var vx=void 0,vy=void 0,vz=void 0;if("vx"in f){vx=f.vx;vy=f.vy;vz=f.vz}else{var _vectorFunction=vectorFunction(f.x,f.y,f.z,f.value);vx=_vectorFunction.vx;vy=_vectorFunction.vy;vz=_vectorFunction.vz}return new x3dom.fields.SFVec3f(vx,vy,vz).length()}));xScale=d3.scaleLinear().domain([minX,maxX]).range([0,dimensionX]);yScale=d3.scaleLinear().domain([minY,maxY]).range([0,dimensionY]);zScale=d3.scaleLinear().domain([minZ,maxZ]).range([0,dimensionZ]);colorScale=d3.scaleSequential().domain(extent.slice().reverse()).interpolator(colors);sizeScale=d3.scaleLinear().domain(extent).range(sizeDomain);origin={x:minX<0?0:minX,y:minY<0?0:minY,z:minZ<0?0:minZ}};var my=function my(selection){if(!x3d){x3d=selection.append("x3d");scene=x3d.append("scene")}x3d.attr("width",width+"px").attr("height",height+"px").attr("showLog",debug?"true":"false").attr("showStat",debug?"true":"false");var layers=["axis","vectorFields"];scene.classed(classed,true).selectAll("group").data(layers).enter().append("group").attr("class",function(d){return d});selection.each(function(data){init(data);viewpoint.centerOfRotation([dimensions.x/2,dimensions.y/2,dimensions.z/2]);scene.call(viewpoint);axis.xScale(xScale).yScale(yScale).zScale(zScale).dimensions(dimensions);scene.select(".axis").datum(origin).call(axis);vectorFields.xScale(xScale).yScale(yScale).zScale(zScale).colorScale(colorScale).sizeScale(sizeScale).vectorFunction(vectorFunction);scene.select(".vectorFields").datum(data).call(vectorFields)})};my.width=function(_v){if(!arguments.length)return width;width=_v;return this};my.height=function(_v){if(!arguments.length)return height;height=_v;return this};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.colorScale=function(_v){if(!arguments.length)return colorScale;colorScale=_v;return my};my.colors=function(_v){if(!arguments.length)return colors;colors=_v;return my};my.sizeScale=function(_v){if(!arguments.length)return sizeScale;sizeScale=_v;return my};my.sizeDomain=function(_v){if(!arguments.length)return sizeDomain;sizeDomain=_v;return my};my.debug=function(_v){if(!arguments.length)return debug;debug=_v;return my};my.vectorFunction=function(_f){if(!arguments.length)return vectorFunction;vectorFunction=_f;return my};return my}function chartVolumeSlice(){var x3d=void 0;var scene=void 0;var width=500;var height=500;var dimensions={x:40,y:40,z:40};var classed="d3X3domVolumeSliceChart";var debug=false;var xScale=void 0;var yScale=void 0;var zScale=void 0;var origin={x:0,y:0,z:0};var imageUrl=void 0;var numberOfSlices=void 0;var slicesOverX=void 0;var slicesOverY=void 0;var volumeStyle="opacitymap";var viewpoint=component.viewpoint();var axis=component.crosshair();var volumeSlice=component.volumeSlice();var my=function my(selection){if(!x3d){x3d=selection.append("x3d");scene=x3d.append("scene")}x3d.attr("width",width+"px").attr("height",height+"px").attr("showLog",debug?"true":"false").attr("showStat",debug?"true":"false");var layers=["axis","volumeSlice"];scene.classed(classed,true).selectAll("group").data(layers).enter().append("group").attr("class",function(d){return d});selection.each(function(data){viewpoint.centerOfRotation([dimensions.x/2,dimensions.y/2,dimensions.z/2]);scene.call(viewpoint);axis.dimensions(dimensions).xScale(xScale).yScale(yScale).zScale(zScale);scene.select(".axis").datum(origin).call(axis);volumeSlice.dimensions(dimensions).imageUrl(imageUrl).numberOfSlices(numberOfSlices).slicesOverX(slicesOverX).slicesOverY(slicesOverY);scene.select(".volumeSlice").append("transform").attr("translation",function(d){var x=dimensions.x/2;var y=dimensions.y/2;var z=dimensions.z/2;return x+" "+y+" "+z}).datum(function(d){return d}).call(volumeSlice)})};my.width=function(_v){if(!arguments.length)return width;width=_v;return this};my.height=function(_v){if(!arguments.length)return height;height=_v;return this};my.xScale=function(_v){if(!arguments.length)return xScale;xScale=_v;return my};my.yScale=function(_v){if(!arguments.length)return yScale;yScale=_v;return my};my.zScale=function(_v){if(!arguments.length)return zScale;zScale=_v;return my};my.dimensions=function(_v){if(!arguments.length)return dimensions;dimensions=_v;return this};my.imageUrl=function(_v){if(!arguments.length)return imageUrl;imageUrl=_v;return this};my.numberOfSlices=function(_v){if(!arguments.length)return numberOfSlices;numberOfSlices=_v;return this};my.slicesOverX=function(_v){if(!arguments.length)return slicesOverX;slicesOverX=_v;return this};my.slicesOverY=function(_v){if(!arguments.length)return slicesOverY;slicesOverY=_v;return this};my.volumeStyle=function(_v){if(!arguments.length)return volumeStyle;volumeStyle=_v;return this};my.debug=function(_v){if(!arguments.length)return debug;debug=_v;return my};return my}var chart={areaChartMultiSeries:chartAreaChartMultiSeries,barChartMultiSeries:chartBarChartMultiSeries,barChartVertical:chartBarChartVertical,bubbleChart:chartBubbleChart,crosshairPlot:chartCrosshairPlot,ribbonChartMultiSeries:chartRibbonChartMultiSeries,scatterPlot:chartScatterPlot,surfacePlot:chartSurfacePlot,vectorFieldChart:chartVectorField,volumeSliceChart:chartVolumeSlice};var countries=["UK","France","Spain","Germany","Italy","Portugal"];var fruit=["Apples","Oranges","Pears","Bananas"];function randomNum(){return Math.floor(Math.random()*10)+1}function dataset1(){var data={key:"Fruit",values:fruit.map(function(d){return{key:d,value:randomNum(),x:randomNum(),y:randomNum(),z:randomNum()}})};return data}function dataset2(){var data=countries.map(function(d){return{key:d,values:fruit.map(function(d){return{key:d,value:randomNum(),x:randomNum(),y:randomNum(),z:randomNum()}})}});return data}function dataset3(){var points=arguments.length>0&&arguments[0]!==undefined?arguments[0]:10;var data={key:"Bubbles",values:d3.range(points).map(function(d,i){return{key:"Point"+i,value:randomNum(),x:randomNum(),y:randomNum(),z:randomNum()}})};return data}function dataset4(){var data=[{key:"a",values:[{key:"1",value:4},{key:"2",value:0},{key:"3",value:2},{key:"4",value:0},{key:"5",value:0}]},{key:"b",values:[{key:"1",value:4},{key:"2",value:0},{key:"3",value:2},{key:"4",value:0},{key:"5",value:0}]},{key:"c",values:[{key:"1",value:1},{key:"2",value:0},{key:"3",value:1},{key:"4",value:0},{key:"5",value:0}]},{key:"d",values:[{key:"1",value:4},{key:"2",value:0},{key:"3",value:2},{key:"4",value:0},{key:"5",value:0}]},{key:"e",values:[{key:"1",value:1},{key:"2",value:1},{key:"3",value:1},{key:"4",value:1},{key:"5",value:1}]}];return data}function dataset5(){var cx=.8;var cy=.3;var f=function f(vx,vz){return((vx-cx)*(vx-cx)+(vz-cy)*(vx-cx))*Math.random()};var xRange=d3.range(0,1.05,.1);var zRange=d3.range(0,1.05,.1);var nx=xRange.length;var nz=zRange.length;var data=d3.range(nx).map(function(i){var values=d3.range(nz).map(function(j){return{key:j,value:f(xRange[i],zRange[j])}});return{key:i,values:values}});return data}var randomData=Object.freeze({countries:countries,fruit:fruit,randomNum:randomNum,dataset1:dataset1,dataset2:dataset2,dataset3:dataset3,dataset4:dataset4,dataset5:dataset5});var author$1="James Saunders";var year=(new Date).getFullYear();var copyright="Copyright (C) "+year+" "+author$1;var index={version:version,author:author$1,copyright:copyright,license:license,chart:chart,component:component,dataTransform:dataTransform,randomData:randomData,events:events};return index});
